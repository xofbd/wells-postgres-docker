#!/bin/bash
#
# Attempt to access the database with the postgres admin account.
set -eu

source test/functions.sh
URL_ADMIN=$(bin/construct-url --admin)

list_tables() {
    psql -l $URL_ADMIN
}

main() {
    local message
    message=$(list_tables 2>&1) || : # having || : let's us use set -eu

    if echo $message | grep -q "no pg_hba.conf entry"; then
	echo_success "PASSED: postgres admin user is locked out of the database"
    else
	echo_failure "FAILED: postgres admin user is not locked out the database"
    fi
}


main
